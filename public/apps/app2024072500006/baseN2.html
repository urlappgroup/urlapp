<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BaseN Encoder/Decoder</title>

</head>

<body>

    <h2>BaseN Encoder/Decoder</h2>
    <div> <label>è‡ªå®šä¹‰å­—ç¬¦é›†åˆçš„ç¼–ç /è§£ç </label></div>
    <br>
    å¯ä»¥è¯•è¯•å‡ ä¸ªæœ‰æ„æ€çš„ç»„åˆ:
    <br>
    æ‘©å°”æ–¯:._
    <br>
    oo:oO
    <br>
    emoji:ğŸ˜€ğŸ˜ğŸ˜‚ğŸ¤£ğŸ˜ƒğŸ˜„ğŸ˜…ğŸ˜†ğŸ˜‰ğŸ˜ŠğŸ˜‹ğŸ˜ğŸ˜ğŸ˜˜ğŸ˜—ğŸ˜™ğŸ˜šğŸ™‚ğŸ¤—ğŸ¤”ğŸ˜ğŸ˜‘ğŸ˜¶ğŸ˜ğŸ˜£ğŸ˜¥ğŸ˜®ğŸ¤ğŸ˜¯ğŸ˜ªğŸ˜«ğŸ˜´ğŸ˜ŒğŸ˜›ğŸ˜œğŸ˜ğŸ˜’ğŸ˜“ğŸ˜”ğŸ˜•ğŸ™ƒğŸ¤‘ğŸ˜²ğŸ™„ğŸ˜³ğŸ˜ğŸ˜ŸğŸ˜ ğŸ™ğŸ˜–ğŸ˜«ğŸ˜©ğŸ˜¤
    <br>
    ä¹ç¬¦:â™ªâ™«â™©â™¬
    <br>
    éŸ³ä¹:ğŸ™ğŸ¤ğŸ§ğŸµğŸ¶ğŸ·ğŸ¸ğŸ¹ğŸºğŸ»ğŸ¼ğŸ¥ğŸªğŸª‘ğŸª’ğŸª“ğŸª”ğŸª•ğŸª–ğŸª—ğŸª˜
    <br>
    æœˆç›¸:ğŸŒ‘ğŸŒ’ğŸŒ“ğŸŒ”ğŸŒ•ğŸŒ–ğŸŒ—ğŸŒ˜ğŸŒ™
    <br>
    æ‰‘å…‹:ğŸƒğŸƒ‚ğŸƒƒğŸƒ„ğŸƒ…ğŸƒ†ğŸƒ‡ğŸƒˆğŸƒ‰ğŸƒŠğŸƒ‹ğŸƒŒğŸƒğŸƒğŸ‚±ğŸ‚²ğŸ‚³ğŸ‚´ğŸ‚µğŸ‚¶ğŸ‚·ğŸ‚¸ğŸ‚¹ğŸ‚ºğŸ‚»ğŸ‚¼ğŸ‚½ğŸ‚¾ğŸ‚¡ğŸ‚¢ğŸ‚£ğŸ‚¤ğŸ‚¥ğŸ‚¦ğŸ‚§ğŸ‚¨ğŸ‚©ğŸ‚ªğŸ‚«ğŸ‚¬ğŸ‚­ğŸ‚®ğŸƒ‘ğŸƒ’ğŸƒ“ğŸƒ”ğŸƒ•ğŸƒ–ğŸƒ—ğŸƒ˜ğŸƒ™ğŸƒšğŸƒ›ğŸƒœğŸƒğŸƒ
    <br>
    è±¡å½¢æ–‡å­—:ğ“€€ğ“€
    <br>
    é¢œè‰²:ğŸŸ¦ğŸŸ¥ğŸŸ§ğŸŸ¨ğŸŸ©ğŸŸªğŸŸ«
    <br>
    ä¸å¯è§å­—ç¬¦(å†…å«ä¸å¯è§å­—ç¬¦,é€šè¿‡å…¨é€‰-å¤åˆ¶-ç²˜è´´æ–¹å¼å¸–åˆ°å­—ç¬¦é›†):<input value="&#x200B;&#x200C;&#x200D;">
    <br>
    <br>
    æœ€åå£°æ˜ä¸€ä¸ªåˆ†äº«æ ¼å¼: <br>
    (å­—ç¬¦é›†)[ç¼–ç å†…å®¹] <br>
    è¿™æ ·æœªæ¥è§£ç çš„æ—¶å€™å°±çŸ¥é“æ€ä¹ˆè§£æäº†,ä½†ä¸çŸ¥é“çš„äººè¿˜æ˜¯ä¸çŸ¥é“æ˜¯ä»€ä¹ˆ<br>
    <br>
    <div>
        <label for="charSetInput">å­—ç¬¦é›†: åœ¨è¿™é‡Œè¾“å…¥å­—ç¬¦é›†,ä¾‹å¦‚â€œOoâ€,è¾“å‡ºçš„ç¼–ç å†…å®¹å°±ç”¨è¿™ä¸ªå­—ç¬¦é›†åˆè¡¨ç¤º,2-64å­—ç¬¦</label>
        <input type="text" id="charSetInput"
            value="ğ“€€ğ“€ğ“€‚ğ“€ƒğ“€„ğ“€…ğ“€†ğ“€‡ğ“€ˆğ“€‰ğ“€Šğ“€‹ğ“€Œğ“€ğ“€ğ“€ğ“€ğ“€‘ğ“€’ğ“€“ğ“€”ğ“€•ğ“€–ğ“€—ğ“€˜ğ“€™ğ“€šğ“€›ğ“€œğ“€ğ“€ğ“€Ÿğ“€ ğ“€¡ğ“€¢ğ“€£ğ“€¤ğ“€¥ğ“€¦ğ“€§ğ“€¨ğ“€©ğ“€ªğ“€«ğ“€¬ğ“€­ğ“€®ğ“€¯ğ“€°ğ“€±ğ“€²ğ“€³ğ“€´ğ“€µğ“€¶ğ“€·ğ“€¸ğ“€¹ğ“€ºğ“€»ğ“€¼ğ“€½ğ“ğ“‚"
            oninput="updateCharSet()" style="width: 100%;" />
    </div>
    <br>
    <div>
        <label for="inputString">è¾“å…¥ç¼–ç å†…å®¹:(è¾“å…¥å†…å®¹è§¦å‘ç¼–ç )</label>
        <textarea id="inputString" oninput="encodeToBase64()" placeholder="åœ¨è¿™é‡Œè¾“å…¥è¦ç¼–ç çš„æ–‡æœ¬æ•°æ®,ä¾‹å¦‚-_ Oo ._ ğŸ˜€ğŸ˜ (è¾“å…¥åè§¦å‘è½¬æ¢)"
            style="width: 100%; height: 100px;"></textarea>
    </div>
    <br>
    <div>
        <label for="base64String">è¾“å…¥è§£ç å†…å®¹:(è¾“å…¥ç¼–ç å†…å®¹è§¦å‘è§£ç )</label>
        <textarea id="base64String" oninput="decodeFromBase64()" placeholder="åœ¨è¿™é‡Œè¾“å…¥è¦è§£ç çš„æ•°æ®(è¾“å…¥åè§¦å‘è½¬æ¢)"
            style="width: 100%; height: 100px;"></textarea>
    </div>

</body>
<script>
    let stringWithSpecialChars = String.fromCodePoint(0x200B) + String.fromCodePoint(0x200C) + String.fromCodePoint(0x200D);
    var base64Set0 = '=ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';

    function getUTF8Char(str, index) {
        let arr = [...str];
        return arr[index];
    }
    function getUTF8Len(str) {

        return [...str].length;
    }
    function getUTF8IndexOf(str, cc) {
        return [...str].indexOf(cc);
    }


    function replaceByCharTable(charSet, base64Set, data) {
        if (charSet > 64) {
            charSet = charSet.substring(0, 64);
        }


        let res = "";
        debugger
        let length = [...data].length;
        for (var i = 0; i < length; i++) {
            res += encodeBaseN(charSet, base64Set, getUTF8Char(data, i));

        }
        return res;
    }
    function replaceBackByCharTable(charSet, base64Set, encodeData) {
        if (charSet > 64) {
            charSet = charSet.substring(0, 64);
        }


        let res = "";
        let dloopiv = regNum(getUTF8Len(charSet), base64Set.length);

        let length = [...encodeData].length;

        for (var i = 0; i < length; i += dloopiv) {
            let code = decodeBaseN(charSet, base64Set, [...encodeData].slice(i, i + dloopiv).join(""));

            res += getUTF8Char(base64Set, code);

        }
        return res;
    }
    function decodeBaseN(charSet, base64Set, str) {
        let res = 0;
        let curUnit = 1;
        let length = [...str].length;

        for (var i = 0; i < length; i++) {
            let cc = getUTF8Char(str, i);
            let code = getUTF8IndexOf(charSet, cc);

            res += curUnit * code;
            curUnit = curUnit * getUTF8Len(charSet);

        }
        return res;

    }
    function encodeBaseN(charSet, base64Set, char) {

        let index = base64Set.indexOf(char);
        let res = "";
        let remain = index;
        let len = getUTF8Len(charSet);
        let dloopiv = regNum(getUTF8Len(charSet), base64Set.length);
        for (var i = 0; i < dloopiv; i++) {

            let div = Math.floor(remain / len);
            let code = remain % len;
            let cc = getUTF8Char(charSet, code);

            console.log(cc);
            cc = cc + "";
            console.log(cc);
            remain = div;
            res += cc;


        }
        return res;

    }
    function regNum(div, num) {
        let remain = num;
        let res = 0;
        while (true) {
            let nn = Math.floor(remain / div);
            if (nn > 0) {

                res++;
                remain = nn;
                continue;
            } else

                if (remain % div > 0) {

                    return res + 1;
                } else {
                    return res;
                }

        }
    }


    function encodeToBase64() {
        var input = document.getElementById("inputString").value;
        var encoded = btoa(unescape(encodeURIComponent(input)));
        console.log("from=" + input)
        console.log("encoded=" + encoded)
        let charSet = document.getElementById('charSetInput').value;

        encoded = replaceByCharTable(charSet, base64Set0, encoded)
        console.log("encoded cus=" + encoded)

        document.getElementById("base64String").value = encoded;
    }

    function decodeFromBase64() {
        var input = document.getElementById("base64String").value;
        try {
            let charSet = document.getElementById('charSetInput').value;

            var input1 = replaceBackByCharTable(charSet, base64Set0, input)
            console.log("from=" + input)
            console.log("decoded=" + input1)
            var decoded = decodeURIComponent(escape(atob(input1)));

            document.getElementById("inputString").value = decoded;
        } catch (e) {
            alert('Invalid Base64 string.');
        }
    }

    function updateCharSet() {
        charSet = document.getElementById('charSetInput').value;
        if (getUTF8Len(charSet) < 2) {
            return;
        }
        encodeToBase64();
    }
</script>

</html>